syntax = "proto3";
package courier;

import "google/protobuf/timestamp.proto";

/// Service for working with posts that were scraped from feeds.
service Posts {
  /// Gets a list of posts for a particular user.
  rpc GetUserPosts(ListUserPostsRequest) returns (PostList);

  /// Imports a post from a user's feed.
  rpc ImportPost(ImportPostRequest) returns (Post);
}

/// Request message for listing posts for a user.
message ListUserPostsRequest {
  /// The ID of the users whose posts should be listed.
  int32 user_id = 1;
}

/**
 * Request message for importing a user post.
 * A post may be imported multiple times, presumably each time the feed is scraped while the post is present in the feed. If the post has been imported before, it will be updated.
 */
message ImportPostRequest {
  /// The ID of the user whose feed the post is imported from.
  int32 user_id = 1;
  /// The post information to import.
  Post post = 2;
}

/// Message containing a list of multiple Posts.
message PostList {
  /// The posts in the list.
  repeated Post posts = 1;
}

/**
 * Message describing a post that was scraped from a feed.
 * Many of the fields for a post are pulled directly from a matching JSON Feed field.
 */
message Post {
  /// Autogenerated unique identifier for the post.
  int64 id = 7;
  /**
   * Unique identifier for the post within its feed.
   * Assigned by the feed author. If a post is updated, its ID should not change.
   */
  string item_id = 1;
  /// The identifier of the feed the post was imported from.
  int32 feed_id = 2;
  /// The HTML content of the post. May not be present if content_text is present.
  string content_html = 3;
  /// The plain text content of the post. May not be present if content_html is present.
  string content_text = 4;
  /// The title of the post. May be empty for posts with no title.
  string title = 5;
  /// The URL of the post. In many feeds, this will be the same as the id, but it does not have to be.
  string url = 6;
  /// The tweets that contain the content of this post.
  repeated PostTweet tweets = 9;
}

/// A tweet that was translated from a post.
message PostTweet {
  int64 id = 1;
  int64 post_id = 2;
  string body = 3;
}
